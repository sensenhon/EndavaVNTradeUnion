{% extends 'employee/base.html' %}
{% load employee_extras %}
{% block content %}
<h2 class="text-center" style="margin-bottom:0px; margin-top:64px">Membership</h2>

<div class="container page-content" style="margin-top:0px;">
    <!-- For TU membership = YES -->
    <h4 class="mt-5 mb-3" style="margin-top:64px;">Permanant ({{ employees.count }})</h4>
    <!-- This is for filter bar -->
    <div class="d-flex mb-2" style="align-items:center; gap:6px; flex-wrap:wrap; justify-content:space-between;">
        <form method="get" class="d-flex" style="align-items:center; gap:6px; flex-wrap:wrap; flex:1;">
            <input type="text" name="name" class="form-control form-control-sm" placeholder="Search name" value="{{ request.GET.name }}">
        </form>
        <form method="get" class="d-flex" style="align-items:center; gap:6px; flex-wrap:wrap;">
            <select name="discipline" class="form-select form-control-sm" style="color:rgba(33,37,41,0.6); border-color:rgba(33,37,41,0.3); background-color:rgba(255,255,255,0.95);">
                <option value="" style="color:rgba(33,37,41,0.5);">All Disciplines</option>
                {% for d in discipline_list %}
                    <option value="{{ d.name }}" {% if request.GET.discipline == d.name %}selected{% endif %} style="color:rgba(33,37,41,0.7);">{{ d.name }}</option>
                {% endfor %}
            </select>
            <select name="birth_month" class="form-select form-control-sm" style="color:rgba(33,37,41,0.6); border-color:rgba(33,37,41,0.3); background-color:rgba(255,255,255,0.95);">
                <option value="" {% if not selected_birth_month %}selected{% endif %} style="color:rgba(33,37,41,0.5);">All Months</option>
                {% for m in birth_month_options %}
                    <option value="{{ m }}" {% if selected_birth_month == m|stringformat:'s' %}selected{% endif %} style="color:rgba(33,37,41,0.7);">{{ m }}</option>
                {% endfor %}
            </select>
            <select name="floor" class="form-select form-control-sm" style="color:rgba(33,37,41,0.6); border-color:rgba(33,37,41,0.3); background-color:rgba(255,255,255,0.95);">
                <option value="" style="color:rgba(33,37,41,0.5);">All Floors</option>
                {% for f in floor_list %}
                    <option value="{{ f.name }}" {% if request.GET.floor == f.name %}selected{% endif %} style="color:rgba(33,37,41,0.7);">{{ f.name }}</option>
                {% endfor %}
            </select>
            <select name="tu_committee" class="form-select form-control-sm" style="color:rgba(33,37,41,0.6); border-color:rgba(33,37,41,0.3); background-color:rgba(255,255,255,0.95);">
                <option value="" style="color:rgba(33,37,41,0.5);">All TU Committees</option>
                {% for committee in tu_committees %}
                    <option value="{{ committee.id }}" {% if request.GET.tu_committee == committee.id|stringformat:'s' %}selected{% endif %}>{{ committee.user.username }}</option>
                {% endfor %}
            </select>
            <select name="sort" class="form-select form-control-sm" style="color:rgba(33,37,41,0.6); border-color:rgba(33,37,41,0.3); background-color:rgba(255,255,255,0.95);">
                <option value="">Sort by...</option>
                {% for field, label in display_fields %}
                    <option value="{{ field }}" {% if request.GET.sort == field %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-sm btn-primary" style="margin-top:0px;">Filter/Sort</button>
            <a href="?" class="btn btn-sm btn-secondary ms-2" style="margin-top:0px;">Reset</a>
            <a href="{% url 'export_dashboard_excel' %}?name={{ request.GET.name }}&discipline={{ request.GET.discipline }}&floor={{ request.GET.floor }}{% for m in selected_birth_month %}&birth_month={{ m }}{% endfor %}&sort={{ request.GET.sort }}" class="btn btn-sm btn-success ms-2" style="margin-top:0px; white-space:nowrap;">Export Excel</a>
        </form>
    </div>

    <div style="overflow-x:auto; overflow-y:auto; max-height:380px; width:100%; margin-top:12px;">
        <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
            <!-- Table Header Display -->
            <thead>
                <tr>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                    {% for field, label in display_fields %}
                        {% if field == 'person_number' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                        {% elif field == 'user' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'full_name_en' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'full_name_vn' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'email' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'gender' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'dob' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'birth_month' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'discipline' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'floor' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'job_title' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'working_type' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                        {% elif field == 'trade_union_member' %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                        {% else %}
                            <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                        {% endif %}
                    {% endfor %}
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Children Gift (June)</th>
                    <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                    <tr>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                            {% elif field == 'user' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:100px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.user.username }}</td>
                            {% elif field == 'full_name_en' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                            {% elif field == 'full_name_vi' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                            {% elif field == 'birth_month' %}
                                <td style="text-align:center; padding:6px 2px; vertical-align:middle; font-size:0.75em; width:32px; max-width:32px; min-width:32px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                    {% if emp.dob %}{{ emp.dob|date:'n' }}{% else %}-{% endif %}
                                </td>
                            {% elif field == 'trade_union_member' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                            {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% else %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% endif %}
                        {% endfor %}
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                            {% if employee_children_ages|dict_get:emp.id and employee_children_ages|dict_get:emp.id|length > 0 %}
                                {% for child_info in employee_children_ages|dict_get:emp.id %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox"
                                               class="june-gift-checkbox"
                                               data-child-id="{{ child_info.child.id }}"
                                               style="margin-right:4px;"
                                               {% if child_info.child.june_gift_received %}checked{% endif %}
                                               {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                        <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                        {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                        </span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label style="display:flex; align-items:center; margin-right:8px;">
                                    <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                    <span> No children</span>
                                </label>
                            {% endif %}
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                            <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- FOR NEWCOMERS -->
    {% if newcomers and newcomers.count > 0 %}
        <h4 class="mt-5 mb-3" style="margin-top:64px;">Newcomers ({{ newcomers.count }})</h4>
        <div style="overflow-x:auto; overflow-y:auto; max-height:450px; width:100%;">
            <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
                <!-- Table Header Display -->
                <thead>
                    <tr>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                            {% elif field == 'user' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_en' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_vn' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'email' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'gender' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'dob' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'birth_month' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'discipline' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'floor' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                                {% elif field == 'job_title' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'working_type' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'trade_union_member' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                            {% else %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% endif %}
                        {% endfor %}
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Children Gift (June)</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                    </tr>
                </thead>
                <!-- Employee Data Display -->
                <tbody>
                    {% for emp in newcomers %}
                    <tr>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                            {% elif field == 'user' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:100px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.user.username }}</td>
                            {% elif field == 'full_name_en' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                            {% elif field == 'full_name_vi' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                            {% elif field == 'trade_union_member' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                            {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' or field == 'birth_month' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% else %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% endif %}
                        {% endfor %}
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                            {% if newcomers_children_ages|dict_get:emp.id and newcomers_children_ages|dict_get:emp.id|length > 0 %}
                                {% for child_info in newcomers_children_ages|dict_get:emp.id %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox"
                                               class="june-gift-checkbox"
                                               data-child-id="{{ child_info.child.id }}"
                                               style="margin-right:4px;"
                                               {% if child_info.child.june_gift_received %}checked{% endif %}
                                               {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                        <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                        {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                        </span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label style="display:flex; align-items:center; margin-right:8px;">
                                    <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                    <span> No children</span>
                                </label>
                            {% endif %}
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                            <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <!-- FOR MATERNITY -->
    {% if maternity and maternity.count > 0 %}
        <h4 class="mt-5 mb-3" style="margin-top:64px;">Maternity ({{ maternity.count }})</h4>
        <div style="overflow-x:auto; overflow-y:auto; max-height:450px; width:100%;">
            <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
                <!-- Table Header Display -->
                <thead>
                    <tr>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                            {% elif field == 'user' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_en' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_vn' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'email' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'gender' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'dob' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'birth_month' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'discipline' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'floor' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                                {% elif field == 'job_title' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'working_type' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'trade_union_member' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                            {% else %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% endif %}
                        {% endfor %}
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Children Gift (June)</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                    </tr>
                </thead>
                <!-- Employee Data Display -->
                <tbody>
                    {% for emp in maternity %}
                    <tr>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                            {% elif field == 'user' %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:100px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.user.username }}</td>
                            {% elif field == 'full_name_en' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                            {% elif field == 'full_name_vi' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                            {% elif field == 'birth_month' %}
                                <td style="text-align:center; padding:6px 2px; vertical-align:middle; font-size:0.75em; width:32px; max-width:32px; min-width:32px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                    {% if emp.dob %}{{ emp.dob|date:'n' }}{% else %}-{% endif %}
                                </td>
                            {% elif field == 'trade_union_member' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                            {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% else %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% endif %}
                        {% endfor %}
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                            {% if maternity_children_ages|dict_get:emp.id and maternity_children_ages|dict_get:emp.id|length > 0 %}
                                {% for child_info in maternity_children_ages|dict_get:emp.id %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox"
                                               class="june-gift-checkbox"
                                               data-child-id="{{ child_info.child.id }}"
                                               style="margin-right:4px;"
                                               {% if child_info.child.june_gift_received %}checked{% endif %}
                                               {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                        <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                        {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                        </span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label style="display:flex; align-items:center; margin-right:8px;">
                                    <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                    <span> No children</span>
                                </label>
                            {% endif %}
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                            <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            </table>
        </div>
    {% endif %}

    <!-- FOR MILITARY -->
    {% if military and military.count > 0 %}
        <h4 class="mt-5 mb-3" style="margin-top:64px;">Military ({{ military.count }})</h4>
        <div style="overflow-x:auto; overflow-y:auto; max-height:450px; width:100%;">
            <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
                <thead>
                    <tr>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                            {% elif field == 'user' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_en' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_vn' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'email' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'gender' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'dob' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'birth_month' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'discipline' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'floor' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                                {% elif field == 'job_title' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'working_type' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'trade_union_member' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                            {% else %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% endif %}
                        {% endfor %}
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Children Gift (June)</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in military %}
                    <tr>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                            {% elif field == 'user' %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:100px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.user.username }}</td>
                            {% elif field == 'full_name_en' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                            {% elif field == 'full_name_vi' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                            {% elif field == 'birth_month' %}
                                <td style="text-align:center; padding:6px 2px; vertical-align:middle; font-size:0.75em; width:32px; max-width:32px; min-width:32px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                    {% if emp.dob %}{{ emp.dob|date:'n' }}{% else %}-{% endif %}
                                </td>
                            {% elif field == 'trade_union_member' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                            {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% else %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% endif %}
                        {% endfor %}
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                            {% if military_children_ages|dict_get:emp.id and military_children_ages|dict_get:emp.id|length > 0 %}
                                {% for child_info in military_children_ages|dict_get:emp.id %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox"
                                               class="june-gift-checkbox"
                                               data-child-id="{{ child_info.child.id }}"
                                               style="margin-right:4px;"
                                               {% if child_info.child.june_gift_received %}checked{% endif %}
                                               {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                        <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                        {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                        </span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label style="display:flex; align-items:center; margin-right:8px;">
                                    <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                    <span> No children</span>
                                </label>
                            {% endif %}
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                            <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <!-- FOR WITHDRAWN -->
    {% if withdrawn_no and withdrawn_no.count > 0 %}
        <h4 class="mt-5 mb-3" style="margin-top:64px;">Withdrawn & No ({{withdrawn_no.count}})</h4>
        <div style="overflow-x:auto; overflow-y:auto; max-height:450px; width:100%;">
            <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
                <thead>
                    <tr>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                            {% elif field == 'user' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_en' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_vn' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'email' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'gender' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'dob' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'birth_month' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'discipline' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'floor' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                                {% elif field == 'job_title' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'working_type' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'trade_union_member' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                            {% else %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% endif %}
                        {% endfor %}
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Children Gift (June)</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in withdrawn_no %}
                    <tr>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                            {% elif field == 'user' %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:100px; max-width:100px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.user.username }}</td>
                            {% elif field == 'full_name_en' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                            {% elif field == 'full_name_vi' %}
                                  <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                            {% elif field == 'trade_union_member' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                            {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' or field == 'birth_month' %}
                                <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% else %}
                                <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                            {% endif %}
                        {% endfor %}
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                            <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                        </td>
                        <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                            {% if withdrawn_no_children_ages|dict_get:emp.id and withdrawn_no_children_ages|dict_get:emp.id|length > 0 %}
                                {% for child_info in withdrawn_no_children_ages|dict_get:emp.id %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox"
                                               class="june-gift-checkbox"
                                               data-child-id="{{ child_info.child.id }}"
                                               style="margin-right:4px;"
                                               {% if child_info.child.june_gift_received %}checked{% endif %}
                                               {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                        <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                        {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                        </span>
                                    </label>
                                {% endfor %}
                            {% else %}
                                <label style="display:flex; align-items:center; margin-right:8px;">
                                    <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                    <span> No children</span>
                                </label>
                            {% endif %}
                        </td>
                        <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                            <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <!-- FOR RESIGNATION -->
    {% if resignation and resignation.count > 0 %}
        <h4 class="mt-5 mb-3" style="margin-top:64px;">Resignation ({{ resignation.count }})</h4>
        <div style="overflow-x:auto; overflow-y:auto; max-height:450px; width:100%;">
            <table class="table table-bordered table-striped" style="background: #fff; min-width:1200px; width:100%;">
                <thead>
                    <tr>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:40px; max-width:60px; white-space:nowrap;">No.</th>
                        {% for field, label in display_fields %}
                            {% if field == 'person_number' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:80px; max-width:120px; white-space:nowrap;">PersonNumber</th>
                            {% elif field == 'user' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:100px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_en' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'full_name_vn' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'email' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'gender' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'dob' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'birth_month' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'discipline' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'floor' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:90px; white-space:nowrap;">{{ label }}</th>
                                {% elif field == 'job_title' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'working_type' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'identity_number' or field == 'native_place' or field == 'ethnicity' or field == 'religion' or field == 'education_level' or field == 'specialization' or field == 'address' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">{{ label }}</th>
                            {% elif field == 'trade_union_member' %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Membership</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">MembershipByTU</th>
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:180px; white-space:nowrap;">MembershipSince</th>
                            {% else %}
                                <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:100px; max-width:180px; white-space:nowrap;">{{ label }}</th>
                            {% endif %}
                        {% endfor %}
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">TUCommittee</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Birthday Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Mooncake Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Tet Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:120px; white-space:nowrap;">Lucky Money Gift</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:90px; max-width:150px; white-space:nowrap;">Children Gift (June)</th>
                        <th style="text-align:center; background:#f8f9fa; font-size:0.75em; padding:6px 4px; vertical-align:middle; min-width:120px; max-width:200px; white-space:nowrap;">Profile</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in resignation %}
                        <tr>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em;">{{ forloop.counter }}</td>
                            {% for field, label in display_fields %}
                                {% if field == 'person_number' %}
                                    <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:80px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.person_number }}</td>
                                {% elif field == 'full_name_en' %}
                                    <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_en }}</td>
                                {% elif field == 'full_name_vi' %}
                                    <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:150px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp.full_name_vi }}</td>
                                {% elif field == 'trade_union_member' %}
                                    <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.trade_union_member %}Yes{% else %}No{% endif %}</td>
                                    <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_type_by_admin %}{{ emp.membership_type_by_admin.name }}{% else %}-{% endif %}</td>
                                    <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{% if emp.membership_since %}{{ emp.membership_since|date:'F jS, Y' }}{% else %}-{% endif %}</td>
                                {% elif field == 'floor' or field == 'gender' or field == 'ethnicity' or field == 'religion' or field == 'identity_number' or field == 'birth_month' %}
                                    <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:90px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                                {% else %}
                                    <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ emp|get_field_display:field }}</td>
                                {% endif %}
                            {% endfor %}
                            <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ tu_committee_map|dict_get:emp.id }}</td>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                                <input type="checkbox" class="birthday-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.birthday_gift_received %}checked{% endif %}>
                            </td>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                                <input type="checkbox" class="mooncake-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.mooncake_gift_received %}checked{% endif %}>
                            </td>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                                <input type="checkbox" class="tet-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.tet_gift_received %}checked{% endif %}>
                            </td>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:90px; max-width:120px;">
                                <input type="checkbox" class="luckymoney-gift-checkbox" data-emp-id="{{ emp.id }}" {% if emp.luckymoney_gift_received %}checked{% endif %}>
                            </td>
                            <td style="text-align:left; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:280px; max-width:280px;">
                                {% if resignation_children_ages|dict_get:emp.id and resignation_children_ages|dict_get:emp.id|length > 0 %}
                                    {% for child_info in resignation_children_ages|dict_get:emp.id %}
                                        <label style="display:flex; align-items:center; margin-right:8px;">
                                            <input type="checkbox"
                                                class="june-gift-checkbox"
                                                data-child-id="{{ child_info.child.id }}"
                                                style="margin-right:4px;"
                                                {% if child_info.child.june_gift_received %}checked{% endif %}
                                                {% if child_info.age != None and child_info.age >= 15 %}disabled style="opacity:0.5;"{% else %}style="margin-right:4px;"{% endif %}>
                                            <span> {{ child_info.child.name }} ({{ child_info.child.dob }})
                                            {% if child_info.age != None %}<span style="color:#888; font-size:0.8em;">[{{ child_info.age }}]</span>{% endif %}
                                            </span>
                                        </label>
                                    {% endfor %}
                                {% else %}
                                    <label style="display:flex; align-items:center; margin-right:8px;">
                                        <input type="checkbox" disabled style="opacity:0.5; margin-right:4px;">
                                        <span> No children</span>
                                    </label>
                                {% endif %}
                            </td>
                            <td style="text-align:center; padding:6px 4px; vertical-align:middle; font-size:0.75em; min-width:120px; max-width:200px;">
                                <a href="{% url 'profile' %}?id={{ emp.id }}" class="btn btn-sm btn-xs btn-outline-info" style="font-size:0.7em; padding:2px 6px;">{% if emp.user %}{{ emp.user.username }}{% else %}-{% endif %}</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <!-- Script to handle birthday gift checkbox changes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.birthday-gift-checkbox').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    var empId = this.getAttribute('data-emp-id');
                    var checked = this.checked;
                    // AJAX update
                    fetch('/update_birthday_gift/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({id: empId, value: checked})
                    }).then(r => r.json()).then(data => {
                        // Optionally show success/error
                    });
                });
            });
        });
    </script>

    <!-- Script to handle Tet gift checkbox changes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.tet-gift-checkbox').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    var empId = this.getAttribute('data-emp-id');
                    var checked = this.checked;
                    // AJAX update
                    fetch('/update_tet_gift/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({id: empId, value: checked})
                    }).then(r => r.json()).then(data => {
                        // Optionally show success/error
                    });
                });
            });
        });
    </script>

    <!-- Script to handle Mooncake gift checkbox changes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.mooncake-gift-checkbox').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    var empId = this.getAttribute('data-emp-id');
                    var checked = this.checked;
                    // AJAX update
                    fetch('/update_mooncake_gift/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({id: empId, value: checked})
                    }).then(r => r.json()).then(data => {
                        // Optionally show success/error
                    });
                });
            });
        });
    </script>

    <!-- Script to handle LuckyMoney gift checkbox changes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.luckymoney-gift-checkbox').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    var empId = this.getAttribute('data-emp-id');
                    var checked = this.checked;
                    // AJAX update
                    fetch('/update_luckymoney_gift/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({id: empId, value: checked})
                    }).then(r => r.json()).then(data => {
                        // Optionally show success/error
                    });
                });
            });
        });
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.june-gift-checkbox').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                const childId = this.getAttribute('data-child-id');
                const checked = this.checked;
                fetch('/update_june_gift/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({
                        child_id: childId,
                        june_gift_received: checked
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Optionally show success/error
                });
            });
        });
    });
    </script>
{% endblock %}
